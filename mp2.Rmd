---
title: "Mini-Project 2"
author: "Sneha, Pema, Tenzin"
date: "October 31, 2017"
output: html_document
---

##The Incumbency Advantage

**What is the Incumbent Advantage?**
 
As the incumbent, one holds many advantages over the challenger. Some of these advantages come in the form of:

- Funding

- Name recognition

- National attention

- Fundraising and Campaign Bases

- Control over the instruments of govt.

- Successful Campaign Experience

- Presumption of success and voters

For our project we are looking at whether incumbents held a monetary advantage over their challengers in the U.S. elections for 2012. In order to do this we will take a look at monetary contributions by committees to challengers, incumbents, and open office. 

```{r, include=FALSE, message=FALSE}
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
```

```{r, message=FALSE}
library(tidyverse)
library(lubridate)
```
```{r eval=FALSE}
head(house_elections)
```

```{r, eval = FALSE}
head(committees)
```
```{r, eval = FALSE}
head(candidates)
```
```{r, eval = FALSE}
head(contributions)
```

```{r}
candidate_contributions <- candidates %>%
  #joining candidates and contributions by "cand_id"
  inner_join(contributions, by = "cand_id") %>%
  #selecting the relevant variables
  select(cand_id, cand_name, cand_ici, cand_election_yr, cand_party_affiliation, cmte_id, transaction_type, name, transaction_dt, transaction_amt, state)
```

```{r}
committee_to_cand <- candidate_contributions %>%
  #joining candidates, committees and contributions
  inner_join(committees, by = "cmte_id") %>%
  #select relevant columns
  select(cmte_id, cmte_name, cmte_party_affiliation, transaction_type, name, transaction_dt, transaction_amt, cand_name, cand_party_affiliation, cand_ici, state)

#view dimensions of the new tbl_dr
dim(committee_to_cand)
```
```{r}
#set the desired values of transaction_type
#transaction <- c("24A", "24E")
transaction <- c("24E") #look for transactions advocating election of a candidate
committee_to_cand <- committee_to_cand %>%
  #filter transaction_type to values in 'transaction' i.e either "24A" or "24E"
  filter(transaction_type %in% transaction) %>%
  mutate(transaction_dt = mdy(transaction_dt))

#view dimensions to ensure there is enough data to use in our anaysis
dim(committee_to_cand)
```

```{r}
#filter date to year 2012 i.e transactions between Jan 1st, 2012 to Dec 31st, 2012
committee_trans_2012 <- committee_to_cand %>%
  filter(transaction_dt >= "2012-01-01" & transaction_dt <= "2012-12-31")
head(committee_trans_2012)
dim(committee_trans_2012)
```


```{r}
susanb_cand_fund <- committee_trans_2012 %>%
  #filtered for a certain committee
  filter(cmte_name == "SUSAN B ANTHONY LIST INC. CANDIDATE FUND") %>%
  #grouped by whether candidate is incumbent, challenger or 
  group_by(cmte_name, cand_ici, state) %>%
  summarise(cont_to_ici = sum(transaction_amt, na.rm = TRUE))
head(susanb_cand_fund)

committee_summary <- function(data_trans, cmt_name)
  data_trans %>%
    #filtered for a certain committee
    filter(cmte_name == "SUSAN B ANTHONY LIST INC. CANDIDATE FUND") %>%
    #grouped by whether candidate is incumbent, challenger or 
    group_by(cmte_name, cand_ici) %>%
    summarise(cont_to_ici = sum(transaction_amt, na.rm = TRUE))
```
```{r}
#global variables
col1 <- "#EBDF8E"
col2 <- "#EFC1CF"
col3 <- "#83C6CC"
font <- "sans"
```


```{r , echo=FALSE}
ggplot(susanb_cand_fund, aes(x = state, y = cont_to_ici,
                             fill = cand_ici))+
  coord_flip()+
  ggtitle("Susan B Anthony List Inc. Candidate Fund")+
  geom_bar(stat = "identity") + 
  geom_text(aes(label=cont_to_ici),position=position_stack(vjust=0.5))+
  scale_x_discrete("State") +
  scale_y_continuous("Total '24E' Contributions:\n Transaactions Advocating Election of a Candidate", limits = c(0,10000), breaks = seq(0, 10000, 5000), labels = c("$0", "$5,000", "$10,000")) +
  scale_fill_manual(values = c(col1, col2, col3),
                    name = "Candidate\nStatus",
                    breaks = c("C", "I", "O"),
                    labels = c("Challenger", "Incubent", "Open Office"))+
  theme(plot.title = element_text(lineheight=.8, face="bold", family = font),
        axis.title.x = element_text(size = 9, face = "bold", family = font),
        axis.title.y = element_text(size = 9, face = "bold", family = font),
        legend.position = "bottom",
        legend.title = element_text(size = 9, face = "bold"))
```

```{r}
#function:
contributions <- function(com_name) {
  table <- committee_trans_2012 %>%
  #filtered for a certain committee
  filter(cmte_name == com_name) %>%
  #grouped by whether candidate is incumbent, challenger or 
  group_by(cmte_name, cand_ici, state) %>%
  summarise(cont_to_ici = sum(transaction_amt, na.rm = TRUE))
head(table)

ggplot(table, aes(x = state, y = cont_to_ici,
                             fill = cand_ici))+
  coord_flip()+
  ggtitle(com_name)+
  geom_bar(stat = "identity") + 
  geom_text(aes(label=cont_to_ici),position=position_stack(vjust=0.5))+
  scale_x_discrete("State") +
  scale_y_continuous("Total '24E' Contributions:\n Transaactions Advocating Election of a Candidate", limits = c(0,10000), breaks = seq(0, 10000, 5000), labels = c("$0", "$5,000", "$10,000")) +
  scale_fill_manual(values = c(col1, col2, col3),
                    name = "Candidate\nStatus",
                    breaks = c("C", "I", "O"),
                    labels = c("Challenger", "Incubent", "Open Office"))+
  theme(plot.title = element_text(lineheight=.8, face="bold", family = font),
        axis.title.x = element_text(size = 9, face = "bold", family = font),
        axis.title.y = element_text(size = 9, face = "bold", family = font),
        legend.position = "bottom",
        legend.title = element_text(size = 9, face = "bold"))
}
```


```{r}
com_name <- c("SUSAN B ANTHONY LIST INC. CANDIDATE FUND")
```

```{r}
lapply(com_name, FUN = contributions)
```







