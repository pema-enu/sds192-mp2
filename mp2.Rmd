---
title: "Mini-Project 2"
author: "Sneha, Pema, Tenzin"
date: "October 31, 2017"
output: html_document
---

##The Incumbency Advantage

**What is the Incumbent Advantage?**
 
As the incumbent, one holds many advantages over the challenger. Some of these advantages come in the form of:

- Funding

- Name recognition

- National attention

- Fundraising and Campaign Bases

- Control over the instruments of govt.

- Successful Campaign Experience

- Presumption of success and voters

For our project we are looking at whether incumbents held a monetary advantage over their challengers in the U.S. elections for 2012. In order to do this we will take a look at monetary contributions by committees to challengers, incumbents, and open office. 

```{r, include=FALSE, message=FALSE}
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
```

```{r, message=FALSE}
library(tidyverse)
library(lubridate)
```
```{r eval=FALSE}
head(house_elections)
```

```{r, eval = FALSE}
head(committees)
```
```{r, eval = FALSE}
head(candidates)
```
```{r, eval = FALSE}
head(contributions)
```

```{r}
candidate_contributions <- candidates %>%
  #joining candidates and contributions by "cand_id"
  inner_join(contributions, by = "cand_id") %>%
  #selecting the relevant variables
  select(cand_id, cand_name, cand_ici, cand_election_yr, cand_party_affiliation, cmte_id, transaction_type, name, transaction_dt, transaction_amt)
```

```{r}
committee_to_cand <- candidate_contributions %>%
  #joining candidates, committees and contributions
  inner_join(committees, by = "cmte_id") %>%
  #select relevant columns
  select(cmte_id, cmte_name, cmte_party_affiliation, transaction_type, name, transaction_dt, transaction_amt, cand_name, cand_party_affiliation, cand_ici)

#view dimensions of the new tbl_dr
dim(committee_to_cand)
```
```{r}
#set the desired values of transaction_type
#transaction <- c("24A", "24E")
transaction <- c("24E") #look for transactions advocating election of a candidate
committee_to_cand <- committee_to_cand %>%
  #filter transaction_type to values in 'transaction' i.e either "24A" or "24E"
  filter(transaction_type %in% transaction) %>%
  mutate(transaction_dt = mdy(transaction_dt))

#view dimensions to ensure there is enough data to use in our anaysis
dim(committee_to_cand)
```

```{r}
#filter date to year 2012 i.e transactions between Jan 1st, 2012 to Dec 31st, 2012
committee_trans_2012 <- committee_to_cand %>%
  filter(transaction_dt >= "2012-01-01" & transaction_dt <= "2012-12-31")
head(committee_trans_2012)
unique(committee_trans_2012$cmte_name)[c(1,2,3,4,5,6)]
```


```{r}
committee_summary <- function(data_trans, cmt_name)
  data_trans %>%
    #filtered for a certain committee
    filter(cmte_name == cmt_name) %>%
    #grouped by whether candidate is incumbent, challenger or 
    group_by(cmte_name, cand_ici) %>%
    summarise(cont_to_ici = sum(transaction_amt, na.rm = TRUE))
```

```{r}
plot_cmt_summary <- function(cmt_summary,cmt_name)
  ggplot(cmt_summary, aes(x = cmte_name, y = cont_to_ici,
                          fill = cand_ici))+
  coord_flip() +
  geom_bar(stat = "identity") + 
  scale_x_discrete("Committee", labels = c(cmt_name)) +
  scale_y_continuous("Total Contributions", limits = c(0,sum(cmt_summary$cont_to_ici)), breaks = seq(0,sum(cmt_summary$cont_to_ici), sum(cmt_summary$cont_to_ici)/5), labels = c("0%","20%","40%","60%","80%","100%") ) +
  scale_fill_manual(values = c("#999999", "#E69F00", "#56B4E9"),
                    name = "Candidate\nStatus",
                    breaks = c("C", "I", "O"),
                    labels = c("Challenger", "Incubent", "Open Office"))
#  guides(fill = guide_legend("Candidate
#Status"))
```


```{r  fig.width=5, fig.height=0.75, echo=FALSE}
susanb_cand_fund <- committee_summary(committee_trans_2012,"SUSAN B ANTHONY LIST INC. CANDIDATE FUND")
plot_cmt_summary(susanb_cand_fund,"Susan Anthony")
```

```{r  fig.width=5, fig.height=0.75, echo=FALSE}
amer_cand_fund <- committee_summary(committee_trans_2012,"CLUB FOR GROWTH PAC"  )
plot_cmt_summary(amer_cand_fund,"CLUB FOR GROWTH PAC"  )
```

```{r fig.width=5, fig.height=0.75, echo=FALSE}
ggplot(susanb_cand_fund, aes(x = cmte_name, y = cont_to_ici,
                             fill = cand_ici))+
  coord_flip()+
  geom_bar(stat = "identity") + 
  scale_x_discrete("Committee", labels = c("Susan Anthony")) +
  scale_y_continuous("Total Contributions", limits = c(0,9000), breaks = seq(0,9000, 1000) ) +
  scale_fill_manual(values = c("#999999", "#E69F00", "#56B4E9"),
                    name = "Candidate\nStatus",
                    breaks = c("C", "I", "O"),
                    labels = c("Challenger", "Incubent", "Open Office"))
#  guides(fill = guide_legend("Candidate
#Status"))
```

```{r}
#tidy
susanb_cand_fund_spread <- susanb_cand_fund %>%
  spread(key = "cand_ici", value = "cont_to_ici") %>%
  mutate(total_contributions = C+I+O)
head(susanb_cand_fund_spread)
```

```


```{r}
#tidy
susanb_cand_fund_spread <- susanb_cand_fund %>%
  spread(key = "cand_ici", value = "cont_to_ici") %>%
  mutate(total_contributions = C+I+O)
head(susanb_cand_fund_spread)
```








